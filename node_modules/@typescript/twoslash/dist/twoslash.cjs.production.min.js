"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@typescript/vfs");function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(t=function(){return!!e})()}function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var n="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,o)}function o(){return function(e,n,r){if(t())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,n);var s=new(e.bind.apply(e,o));return r&&i(s,r.prototype),s}(e,arguments,r(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),i(o,e)},o(e)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){switch(t){case"number":return+e;case"string":return e;case"boolean":return"true"===e.toLowerCase()||0===e.length}throw new p("Unknown primitive value in compiler flag","The only recognized primitives are number, string and boolean. Got "+t+" with "+e+".","This is likely a typo.")}var c=!1;try{c="undefined"!=typeof localStorage}catch(e){}var u="undefined"!=typeof process,f=c&&localStorage.getItem("DEBUG")||u&&process.env.DEBUG?console.log:function(e){return""},p=function(e){function t(t,n,r,i){var o,s="\n## "+t+"\n\n"+n+"\n";return r&&(s+="\n"+r),i&&(s+="\n"+i),(o=e.call(this,s)||this).title=void 0,o.description=void 0,o.recommendation=void 0,o.code=void 0,o.title=t,o.description=n,o.recommendation=r,o.code=i,o}var n,r;return r=e,(n=t).prototype=Object.create(r.prototype),n.prototype.constructor=n,i(n,r),t}(o(Error));function h(e){for(var t=[],n=[],r=0,i=0,o=0,s=function(s){var l=e[s],c=function(){i=r,r+=l.length+1},u=function(t){f("Removing line "+s+" for "+t),o++,e.splice(s,1),s--};if(l.includes("//")){var p=/^\s*\/\/\s*\^+( .+)?$/.exec(l),h=/^\s*\/\/\s*\^\?\s*$/.exec(l),d=/^\s*\/\/ prettier-ignore$/.exec(l),m=/^\s*\/\/\s*\^\|$/.exec(l);if(null!==h){var v=l.indexOf("^");n.push({kind:"query",offset:v,text:void 0,docs:void 0,line:s+o-1}),u("having a query")}else if(null!==p){var g=l.indexOf("^"),y=l.lastIndexOf("^")-g+1,w=p[1]?p[1].trim():"";t.push({kind:"highlight",offset:g+i,length:y,text:w,line:s+o-1,start:g}),u("having a highlight")}else if(null!==d)u("being a prettier ignore");else if(null!==m){var x=l.indexOf("^");n.push({kind:"completion",offset:x,text:void 0,docs:void 0,line:s+o-1}),u("having a completion query")}else c()}else c();a=s},a=0;a<e.length;a++)s(a);return{highlights:t,queries:n}}function d(e,t,n){var r=n.get(t.toLowerCase());if(f("Get "+e+" mapped option: "+t+" => "+r),void 0===r){var i=Array.from(n.keys());throw new p("Invalid inline compiler value","Got "+t+" for "+e+" but it is not a supported value by the TS compiler.","Allowed values: "+i.join(","))}return r}function m(e,t,n,r){f("Setting "+e+" to "+t);for(var i,o,s=function(){var r=o.value;if(r.name.toLowerCase()===e.toLowerCase()){switch(r.type){case"number":case"string":case"boolean":n[r.name]=l(t,r.type);break;case"list":var i=r.element.type,s=t.split(",");n[r.name]=s.map("string"==typeof i?function(e){return l(e,i)}:function(e){return d(r.name,e,i)});break;default:n[r.name]=d(r.name,t,r.type)}return{v:void 0}}},c=a(r.optionDeclarations);!(o=c()).done;)if(i=s())return i.v;throw new p("Invalid inline compiler flag","There isn't a TypeScript compiler flag called '"+e+"'.","This is likely a typo, you can check all the compiler flags in the TSConfig reference, or check the additional Twoslash flags in the npm page for @typescript/twoslash.")}var v=/^\/\/\s?@(\w+)$/,g=/^\/\/\s?@(\w+):\s?(.+)$/,y={errors:[],noErrors:!1,showEmit:!1,showEmittedFile:void 0,noStaticSemanticInfo:!1,emit:!1,noErrorValidation:!1};exports.TwoslashError=p,exports.twoslasher=function(t,r,i){var o,s,l;void 0===i&&(i={});var c=null!=(o=i.tsModule)?o:require("typescript"),u=null!=(s=i.lzstringModule)?s:require("lz-string"),d=t,w=function(e){var t={js:"js",javascript:"js",ts:"ts",typescript:"ts",tsx:"tsx",jsx:"jsx",json:"json",jsn:"json"};if(t[e])return t[e];throw new p("Unknown TypeScript extension given to Twoslash","Received "+e+" but Twoslash only accepts: "+Object.keys(t)+" ","")}(r),x="index."+w;f("\n\nLooking at code: \n```"+w+"\n"+t+"\n```\n");var b=n({strict:!0,target:c.ScriptTarget.ES2016,allowJs:!0},null!=(l=i.defaultCompilerOptions)?l:{});!function(e){if(e.includes("// @errors "))throw new p("You have '// @errors ' (with a space)","You want '// @errors: ' (with a colon)","This is a pretty common typo");if(e.includes("// @filename "))throw new p("You have '// @filename ' (with a space)","You want '// @filename: ' (with a colon)","This is a pretty common typo")}(t);var j=(t=function(e){return(e=e.replace(/¨D/g,"$")).replace(/¨T/g,"~")}(t)).split(/\r\n?|\n/g),E=i.customTags?function(e,t){for(var n=[],r=0;r<e.length;){var i;(i=g.exec(e[r]))&&t.includes(i[1])&&(n.push({name:i[1],line:r,annotation:e[r].split("@"+i[1]+": ")[1]}),e.splice(r,1)),r++}return n}(j,i.customTags):[],S=n({},function(e){for(var t=n({},y),r=0;r<e.length;r++){var i=void 0;(i=v.exec(e[r]))?i[1]in t&&(t[i[1]]=!0,f("Setting options."+i[1]+" to true"),e.splice(r,1),r--):(i=g.exec(e[r]))&&i[1]in t&&(t[i[1]]=i[2],f("Setting options."+i[1]+" to "+i[2]),e.splice(r,1),r--)}return"errors"in t&&"string"==typeof t.errors&&(t.errors=t.errors.split(" ").map(Number),f("Setting options.error to ",t.errors)),t}(j),i.defaultOptions),T=function(e,t,r){for(var i=n({},t),o=0;o<e.length;){var s=void 0;if(s=v.exec(e[o]))i[s[1]]=!0,m(s[1],"true",i,r);else{if(!(s=g.exec(e[o]))){o++;continue}if("filename"===s[1]){o++;continue}m(s[1],s[2],i,r)}e.splice(o,1)}return i}(j,b,c);S.showEmittedFile||(S.showEmittedFile=T.jsx&&T.jsx===c.JsxEmit.Preserve?"index.jsx":"index.js");var O=function(){var e=require("path");return(i.vfsRoot||process.cwd()).split(e.sep).join(e.posix.sep)},k=!!i.fsMap,P=k&&i.fsMap?i.fsMap:new Map,F=k?e.createSystem(P):e.createFSBackedSystem(P,O(),c,i.tsLibDirectory),q=k?"/":O()+"/",C=e.createVirtualTypeScriptEnvironment(F,[],c,T,i.customTransformers),I=C.languageService;t=j.join("\n");for(var A,L=[],M=[],_=[],$=function(e,t,n){for(var r,i=e.split(/\r\n?|\n/g),o=e.includes("@filename: "+t)?"global.ts":t,s=[],l=[],c=a(i);!(r=c()).done;){var u=r.value;u.includes("// @filename: ")?(l.push([n+o,s]),o=u.split("// @filename: ")[1].trim(),s=[]):s.push(u)}return l.push([n+o,s]),l.filter((function(e){return e[1].length>0&&(e[1].length>1||""!==e[1][0])}))}(t,x,q),D=["js","jsx","ts","tsx"],N=$.map((function(e){return e[0]})),R=function(){var e=A.value,t=e[0],n=e[1],r=t.split(".").pop()||"",i=T.resolveJsonModule&&"json"===r;if(!D.includes(r)&&!i)return 1;var o=n.join("\n");C.createFile(t,o);var s=h(n);_=_.concat(s.highlights);var a=s.queries.map((function(e,n){var r=C.getSourceFile(t),i=c.getPositionOfLineAndCharacter(r,e.line,e.offset);switch(e.kind){case"query":var o=I.getQuickInfoAtPosition(t,i);if(!o||!o.displayParts)throw new p("Invalid QuickInfo query","The request on line "+e.line+" in "+t+" for quickinfo via ^? returned no from the compiler.","This is likely that the x positioning is off.");return{kind:"query",text:o.displayParts.map((function(e){return e.text})).join(""),docs:o.documentation?o.documentation.map((function(e){return e.text})).join("<br/>"):void 0,line:e.line-n,offset:e.offset,file:t};case"completion":var s=I.getCompletionsAtPosition(t,i-1,{});if(!s&&!S.noErrorValidation)throw new p("Invalid completion query","The request on line "+e.line+" in "+t+" for completions via ^| returned no completions from the compiler.","This is likely that the positioning is off.");var a=function(e,t){e=String(e),t=Number(t)>>>0;var n=e.slice(0,t+1).search(/\S+$/),r=e.slice(t).search(/\s/);return r<0?{word:e.slice(n),startPos:n}:{word:e.slice(n,r+t),startPos:n}}(r.text,i-1),l=r.text.slice(a.startPos,i).split(".").pop()||"";return{kind:"completions",completions:(null==s?void 0:s.entries)||[],completionPrefix:l,line:e.line-n,offset:e.offset,file:t}}}));L=L.concat(a);var l=n.join("\n");C.updateFile(t,l)},U=a($);!(A=U()).done;)R();var B=t.split(/\r\n?|\n/g);h(B),t=B.join("\n"),S.emit&&N.forEach((function(e){var t=e.split(".").pop()||"";D.includes(t)&&I.getEmitOutput(e).outputFiles.forEach((function(e){F.writeFile(e.name,e.text)}))}));var G=[],V=[];N.forEach((function(e){var n=e.split(".").pop()||"";if(D.includes(n)){S.noErrors||(G=G.concat(I.getSemanticDiagnostics(e),I.getSyntacticDiagnostics(e)));var r=C.sys.readFile(e),i=C.getSourceFile(e);if(!i)throw new p("Could not find a  TypeScript sourcefile for '"+e+"' in the Twoslash vfs","It's a little hard to provide useful advice on this error. Maybe you imported something which the compiler doesn't think is a source file?","");if(!S.showEmit){for(var o,s=-1==t.indexOf(r)?0:t.indexOf(r),l=t.slice(0,s).split("\n").length-1,u=S.noStaticSemanticInfo?[]:function(e,t){var n=[];return function r(i){e.forEachChild(i,(function(i){if(e.isIdentifier(i)){var o=i.getStart(t,!1);n.push({span:e.createTextSpan(o,i.end-o),text:i.getText(t)})}r(i)}))}(t),n}(c,i),f=a(u);!(o=f()).done;){var h=o.value,d=h.span,m=I.getQuickInfoAtPosition(e,d.start);if(m&&m.displayParts){var v=m.displayParts.map((function(e){return e.text})).join(""),g=h.text,y=m.documentation?m.documentation.map((function(e){return e.text})).join("\n"):void 0,w=d.start+s,x=c.createSourceFile("_.ts",t,c.ScriptTarget.ES2015),b=c.getLineAndCharacterOfPosition(x,w);V.push({text:v,docs:y,start:w,length:d.length,line:b.line,character:b.character,targetString:g})}}L.filter((function(t){return t.file===e})).forEach((function(e){var t=c.getPositionOfLineAndCharacter(i,e.line,e.offset)+s;switch(e.kind){case"query":M.push({docs:e.docs,kind:"query",start:t+s,length:e.text.length,text:e.text,offset:e.offset,line:e.line+l+1});break;case"completions":M.push({completions:e.completions,kind:"completions",start:t+s,completionsPrefix:e.completionPrefix,length:1,offset:e.offset,line:e.line+l+1})}}))}}}));var Q=G.filter((function(e){return e.file&&N.includes(e.file.fileName)}));!S.noErrorValidation&&Q.length&&function(e,t,n,r,i){var o=e.filter((function(e){return!t.errors.includes(e.code)})),s=Array.from(new Set(o.map((function(e){return e.code})))).join(" ");if(o.length){var a=new Set(e.map((function(e){return e.code}))),l="// @errors: "+Array.from(a).join(" "),c=t.errors.length?"\nThe existing annotation specified "+t.errors.join(" "):"\nExpected: "+l,u={},f=[];o.forEach((function(e){var t,n=(null==(t=e.file)?void 0:t.fileName)&&e.file.fileName.replace(i,"");if(n){var r=u[n];r?r.push(e):u[n]=[e]}else f.push(e)}));var h=function(e,t){return e+"\n  "+t.map((function(e){return"["+e.code+"] "+e.start+" - "+("string"==typeof e.messageText?e.messageText:e.messageText.messageText)})).join("\n  ")},d=[];f.length&&d.push(h("Ambient Errors",f)),Object.keys(u).forEach((function(e){d.push(h(e,u[e]))}));var m=d.join("\n\n"),v=new p("Errors were thrown in the sample, but not included in an errors tag","These errors were not marked as being expected: "+s+". "+c,"Compiler Errors:\n\n"+m);throw v.code="## Code\n\n'''"+n+"\n"+r+"\n'''",v}}(Q,S,r,d,q);for(var Y,z=[],J=function(){var e=Y.value,n=C.sys.readFile(e.file.fileName),r=j.findIndex((function(t){if(t.includes("// @filename: ")){var n=t.split("// @filename: ")[1].trim();return e.file.fileName.endsWith(n)}return!1}))+1,i=t.indexOf(n),o=c.flattenDiagnosticMessageText(e.messageText,"\n"),s="err-"+e.code+"-"+e.start+"-"+e.length,a=c.getLineAndCharacterOfPosition(e.file,e.start);z.push({category:e.category,code:e.code,length:e.length,start:e.start?e.start+i:void 0,line:a.line+r,character:a.character,renderedMessage:o,id:s})},W=a(Q);!(Y=W()).done;)J();if(S.showEmit){var H=S.showEmittedFile||x,K=q+H.replace(".jsx","").replace(".js","").replace(/\.d\.([^\.]+\.)?[cm]?ts$/i,"").replace(".map",""),X=N.find((function(e){return e===K+".ts"||e===K+".tsx"}));if(!X&&!T.outFile){var Z=N.join(", ");throw new p("Could not find source file to show the emit for","Cannot find the corresponding **source** file  "+H+" for completions via ^| returned no quickinfo from the compiler.","Looked for: "+K+" in the vfs - which contains: "+Z)}T.outFile&&(X=N[0]);var ee=I.getEmitOutput(X),te=ee.outputFiles.find((function(e){return e.name===q+S.showEmittedFile||e.name===S.showEmittedFile}));if(!te){var ne=ee.outputFiles.map((function(e){return e.name})).join(", ");throw new p("Cannot find the output file in the Twoslash VFS","Looking for "+S.showEmittedFile+" in the Twoslash vfs after compiling",'Looked for" '+(q+S.showEmittedFile)+" in the vfs - which contains "+ne+".")}t=te.text,r=te.name.split(".").pop(),_=[],L=[],V=[]}var re="https://www.typescriptlang.org/play/#code/"+u.compressToEncodedURIComponent(d),ie="// ---cut---\n";if(t.includes(ie)){var oe=t.indexOf(ie)+13,se=t.substr(0,oe).split("\n").length-1;t=t.split(ie).pop(),V.forEach((function(e){e.start-=oe,e.line-=se})),V=V.filter((function(e){return e.start>-1})),z.forEach((function(e){e.start&&(e.start-=oe),e.line&&(e.line-=se)})),z=z.filter((function(e){return e.start&&e.start>-1})),_.forEach((function(e){e.start-=oe,e.line-=se})),_=_.filter((function(e){return e.start>-1})),M.forEach((function(e){return e.line-=se})),M=M.filter((function(e){return e.line>-1})),E.forEach((function(e){return e.line-=se})),E=E.filter((function(e){return e.line>-1}))}var ae="// ---cut-after---\n";if(t.includes(ae)){var le=t.indexOf(ae)+19,ce=t.substr(0,le).split("\n").length-1;t=t.split(ae).shift().trimEnd(),V=V.filter((function(e){return e.line<ce})),z=z.filter((function(e){return e.line&&e.line<ce})),_=_.filter((function(e){return e.line<ce})),M=M.filter((function(e){return e.line<ce})),E=E.filter((function(e){return e.line<ce}))}return{code:t,extension:r,highlights:_,queries:M,staticQuickInfos:V,errors:z,playgroundURL:re,tags:E}};
//# sourceMappingURL=twoslash.cjs.production.min.js.map
